---
import MailIcon from "../../icons/Mail.astro";
import SendIcon from "../../icons/Send.astro";

const redes = [
  { nombre: "Correo", icono: MailIcon, link: "mailto:natdev.contacto@gmail.com" },
];
---

<section
  id="contact"
  class="container mx-auto px-6 md:px-12 lg:px-16 py-24 grid md:grid-cols-2 gap-16 items-start 
  opacity-0 translate-y-10 transition-all duration-1000 ease-out contacto-section">
  <!-- Contenido izquierda -->
  <div class="space-y-6">
    <h2 class="text-4xl md:text-5xl font-bold text-[var(--color-primary)]">
      ¡Construyamos algo genial juntos!
    </h2>

    <p class="text-lg text-gray-600 dark:text-gray-400 max-w-lg">
      ¿Tienes una idea, proyecto o simplemente quieres saludar?  
      Me encantaría saber de ti. Puedes escribirme por el formulario o contactarme directamente.
    </p>

    <!-- CORREO -->
    <div class="space-y-8">
      <div class="flex items-start gap-4 p-4">
        <div
          class="p-3 rounded-xl bg-[var(--color-primary)]/10 text-[var(--color-primary)] 
                 flex items-center justify-center">
          <MailIcon class="w-7 h-7" />
        </div>
        <div>
          <p class="text-sm font-semibold text-[var(--color-text-light)] uppercase tracking-wide">
            Correo
          </p>
          <a
            href="mailto:natdev.contacto@gmail.com"
            class="block text-lg font-medium text-[var(--color-text)] 
                   hover:text-[var(--color-primary)] transition-colors">
            natdev.contacto@gmail.com
          </a>
        </div>
      </div>
    </div>
  </div>

  <!-- FORMULARIO -->
  <form
    id="contact-form"
    action="https://formspree.io/f/xzzjkbje"
    method="POST"
    class="bg-[var(--color-surface)] dark:bg-[var(--color-bg)] shadow-lg rounded-2xl p-8 flex flex-col gap-5 relative" >
    <!-- NOMBRE -->
    <div>
      <label class="text-sm font-medium text-[var(--color-text)]">
        Tu nombre <span class="text-red-500">*</span>
      </label>
      <input
        type="text"
        name="nombre"
        required
        placeholder="Ej. Natalia"
        class="w-full mt-2 p-3 rounded-lg border border-[var(--color-border)] bg-transparent 
               focus:outline-none focus:ring-2 focus:ring-[var(--color-primary)] transition-all duration-300" />
    </div>

    <!-- CORREO -->
    <div>
      <label class="text-sm font-medium text-[var(--color-text)]">
        Tu correo <span class="text-red-500">*</span>
      </label>
      <input
        type="email"
        name="email"
        required
        placeholder="tucorreo@ejemplo.com"
        class="w-full mt-2 p-3 rounded-lg border border-[var(--color-border)] bg-transparent 
               focus:outline-none focus:ring-2 focus:ring-[var(--color-primary)] transition-all duration-300"/>
    </div>

    <!-- MENSAJE -->
    <div>
      <label class="text-sm font-medium text-[var(--color-text)]">
        Tu mensaje <span class="text-red-500">*</span>
      </label>
      <textarea
        name="mensaje"
        required
        rows="4"
        placeholder="Cuéntame sobre tu idea o proyecto..."
        class="w-full mt-2 p-3 rounded-lg border border-[var(--color-border)] bg-transparent 
               focus:outline-none focus:ring-2 focus:ring-[var(--color-primary)] transition-all duration-300">
      </textarea>
    </div>

    <!-- BOTÓN -->
    <button
      type="submit"
      class="mt-4 py-3 px-6 flex items-center justify-center gap-2 rounded-lg bg-gradient-to-r 
             from-[var(--color-primary)] to-[var(--color-secondary)] text-white font-medium 
             hover:shadow-[0_0_20px_rgba(34,197,94,0.3)] hover:scale-[1.02] active:scale-[0.98] 
             transition-all duration-300" >
      <SendIcon class="w-5 h-5" />
      Enviar mensaje
    </button>
  </form>

  <!--TOAST -->
  <div
    id="toast"
    class="hidden fixed bottom-6 right-6 text-white px-6 py-4 rounded-xl shadow-2xl 
           text-sm font-medium animate-fade-in z-50">
  </div>
</section>

<!-- ESTILOS -->
<style>
  @keyframes fade-in {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  .animate-fade-in {
    animation: fade-in 0.4s ease-out;
  }

  /* Toast con gradiente */
  #toast.success {
    background: linear-gradient(to right, #22c55e, #16a34a);
  }
  #toast.error {
    background: linear-gradient(to right, #f43f5e, #e11d48);
  }
</style>

<!-- SCRIPT -->
<script>
  // Animación de entrada
  const observer = new IntersectionObserver((entries) => {
    entries.forEach((entry) => {
      if (entry.isIntersecting) {
        entry.target.classList.add("opacity-100", "translate-y-0");
        entry.target.classList.remove("opacity-0", "translate-y-10");
      }
    });
  });
  document.querySelectorAll(".contacto-section").forEach((el) =>
    observer.observe(el)
  );

  // Lógica de envío
  const form = document.getElementById("contact-form");
  const toast = document.getElementById("toast");

  if (form && toast) {
    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      const data = new FormData(form);

      try {
        const response = await fetch(form.action, {
          method: form.method,
          body: data,
          headers: { Accept: "application/json" },
        });

        toast.className =
          "fixed bottom-6 right-6 text-white px-6 py-4 rounded-xl shadow-2xl text-sm font-medium animate-fade-in z-50";
        toast.classList.add(response.ok ? "success" : "error");
        toast.textContent = response.ok
          ? "✅ ¡Mensaje enviado correctamente!"
          : "❌ Error al enviar. Intenta nuevamente.";
        toast.classList.remove("hidden");

        if (response.ok) form.reset();
        setTimeout(() => toast.classList.add("hidden"), 5000);
      } catch {
        toast.className =
          "fixed bottom-6 right-6 text-white px-6 py-4 rounded-xl shadow-2xl text-sm font-medium animate-fade-in z-50 error";
        toast.textContent = "⚠️ Error de conexión. Intenta de nuevo.";
        toast.classList.remove("hidden");
        setTimeout(() => toast.classList.add("hidden"), 5000);
      }
    });
  }
</script>

