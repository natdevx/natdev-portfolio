---
import ThemeToggle from "./ThemeToggle.astro";
---

<header class="fixed top-0 left-0 w-full z-50 transition-all duration-300 bg-transparent">
  <div
    class="max-w-3xl mx-auto mt-4 flex items-center justify-between px-4 py-2 rounded-full
           bg-[var(--color-surface)]/60 backdrop-blur-md border border-[var(--color-border)]/40
           shadow-[0_4px_30px_rgba(0,0,0,0.1)] transition-all duration-300">
           
    <!-- Logo -->
    <a href="#home" class="flex items-center gap-2">
      <span class="text-xl font-heading font-bold text-[var(--color-heading)] tracking-tight">
        Nat<span class="text-[var(--color-primary)]">Dev.</span>
      </span>
    </a>

    <!-- Navegaci√≥n Desktop -->
    <nav
      class="hidden md:flex items-center gap-6 text-md font-medium tracking-wide"
      aria-label="Main navigation">
      <a href="#home" class="nav-link active">Inicio</a>
      <a href="#about" class="nav-link">Acerca de m√≠</a>
      <a href="#projects" class="nav-link">Proyectos</a>
      <a href="#contact" class="nav-link">Contacto</a>
    </nav>

    <!-- Botones (Dark Mode + Mobile) -->
    <div class="flex items-center gap-3">
      <ThemeToggle />

      <!-- Men√∫ hamburguesa -->
      <button
        id="mobile-toggle"
        class="md:hidden p-2 rounded-md bg-[var(--color-surface)]/50 hover:bg-[var(--color-surface)]/80 
               text-[var(--color-text)] focus:outline-none focus:ring-2 focus:ring-[var(--color-primary)]"
        aria-label="Abrir men√∫ m√≥vil"
        aria-expanded="false">
        <svg
          class="w-6 h-6"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          aria-hidden="true">
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="1.7"
            d="M4 6h16M4 12h16M4 18h16"/>
        </svg>
      </button>
    </div>
  </div>

  <!-- Men√∫ m√≥vil -->
  <div
    id="mobile-menu"
    class="hidden md:hidden bg-[var(--color-surface)]/80 backdrop-blur-md mt-2 mx-4 rounded-xl border 
    border-[var(--color-border)]/30 shadow-lg">
    <div class="px-6 py-4 flex flex-col gap-3 text-sm font-medium">
      <a href="#home" class="mobile-link">Inicio</a>
      <a href="#about" class="mobile-link">Acerca de m√≠</a>
      <a href="#projects" class="mobile-link">Proyectos</a>
      <a href="#contact" class="mobile-link">Contacto</a>
    </div>
  </div>

  <script>
  document.addEventListener("DOMContentLoaded", () => {
    const navLinks = document.querySelectorAll("nav a");
    const mobileLinks = document.querySelectorAll("#mobile-menu a");
    const sections = document.querySelectorAll("section[id]");
    const mobileToggle = document.getElementById("mobile-toggle");
    const mobileMenu = document.getElementById("mobile-menu");

    // üîπ Mostrar men√∫ m√≥vil
    mobileToggle.addEventListener("click", () => {
      mobileMenu.classList.toggle("hidden");
    });

    // üîπ Marcar "Inicio" activo al cargar
    navLinks.forEach(link => link.classList.remove("active"));
    navLinks[0].classList.add("active");

    // üîπ Funci√≥n para marcar la secci√≥n actual
    const setActiveLink = () => {
      let current = "home"; // valor por defecto

      sections.forEach((section) => {
        const sectionTop = section.offsetTop - 180;
        const sectionHeight = section.offsetHeight;

        // üî∏ Caso especial: todo lo de ‚ÄúAcerca de m√≠‚Äù cuenta como una sola secci√≥n
        if (
          section.id === "about" ||
          section.closest("#about")
        ) {
          const about = document.getElementById("about");
          if (about) {
            const aboutTop = about.offsetTop - 200;
            const aboutHeight = about.offsetHeight;
            if (scrollY >= aboutTop && scrollY < aboutTop + aboutHeight) {
              current = "about";
            }
          }
        }

        if (scrollY >= sectionTop && scrollY < sectionTop + sectionHeight) {
          current = section.getAttribute("id");
        }
      });

      navLinks.forEach((link) => {
        link.classList.remove("active");
        if (link.getAttribute("href") === "#" + current) {
          link.classList.add("active");
        }
      });
    };

    window.addEventListener("scroll", setActiveLink);
    setActiveLink();

    // üîπ Scroll suave con compensaci√≥n
    const smoothScroll = (link) => {
      link.addEventListener("click", (e) => {
        e.preventDefault();
        const targetId = link.getAttribute("href");

        // ‚úÖ Soluci√≥n: si es ‚ÄúInicio‚Äù, sube al principio
        if (targetId === "#home") {
          window.scrollTo({ top: 0, behavior: "smooth" });
        } else {
          const target = document.querySelector(targetId);
          if (target) {
            const offset = 120; // altura del header
            const top = target.offsetTop - offset;
            window.scrollTo({ top, behavior: "smooth" });
          }
        }

        mobileMenu.classList.add("hidden");
      });
    };

    navLinks.forEach(smoothScroll);
    mobileLinks.forEach(smoothScroll);
  });
</script>


  <style>
    /* üîπ Enlaces normales */
    .nav-link {
      position: relative;
      color: var(--color-text);
      transition: color 0.3s ease;
    }
    .nav-link:hover {
      color: var(--color-primary);
    }

    /* üîπ Activo */
    .nav-link.active {
      color: var(--color-primary);
      font-weight: 600;
    }
    .nav-link.active::after {
      content: "";
      position: absolute;
      left: 0;
      bottom: -4px;
      width: 100%;
      height: 2px;
      background-color: var(--color-primary);
      border-radius: 2px;
    }

    /* üîπ Enlaces men√∫ m√≥vil */
    .mobile-link {
      color: var(--color-text);
      transition: color 0.3s ease;
    }
    .mobile-link:hover {
      color: var(--color-primary);
    }
  </style>
</header>
